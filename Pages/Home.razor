@page "/"

<PageTitle>Home</PageTitle>

@using StockPredictionWeb.Models

<LineChart @ref="lineChart" />

@code {
    [Inject]
    private StockDataService StockDataService { get; set; }
    private BarChart barChart;
    private LineChart lineChart;

    private List<StockData> stockData;
    private List<double> actualPrices;
    private List<double> predictedPrices;
    private List<string> labels;
    private double rmse = 3.2010853918806705;
    private double r_squared = 0.9679652510248724;

    protected override async Task OnInitializedAsync()
    {
        stockData = await StockDataService.GetStockDataAsync();
        actualPrices = stockData.Select(item => item.ActualPrices).ToList();
        predictedPrices = stockData.Select(item => item.PredictedPrices).ToList();
        labels = stockData.Select(item => item.Date.ToShortDateString()).ToList();
        Console.WriteLine(predictedPrices);
        await RenderWormAsync();
    }

    private async Task RenderWormAsync()
    {
        var data = new ChartData
            {
                Labels = labels,
                Datasets = new List<IChartDataset>()
                {
                    new LineChartDataset()
                    {
                        Label = "Predicted prices",
                        Data = predictedPrices,
                        BackgroundColor = new List<string>{ "rgb(88, 80, 141)" },
                        BorderColor = new List<string>{ "rgb(88, 80, 141)" },
                        BorderWidth = new List<double>{2},
                        HoverBorderWidth = new List<double>{4},
                        PointBackgroundColor = new List<string>{ "rgb(88, 80, 141)" },
                        PointBorderColor = new List<string>{ "rgb(88, 80, 141)" },
                        PointRadius = new List<int>{0}, // hide points
                        PointHoverRadius = new List<int>{4},
                    },
                    new LineChartDataset()
                    {
                        Label = "Actual prices",
                        Data = actualPrices,
                        BackgroundColor = new List<string>{ "rgb(255, 166, 0)" },
                        BorderColor = new List<string>{ "rgb(255, 166, 0)" },
                        BorderWidth = new List<double>{2},
                        HoverBorderWidth = new List<double>{4},
                        PointBackgroundColor = new List<string>{ "rgb(255, 166, 0)" },
                        PointBorderColor = new List<string>{ "rgb(255, 166, 0)" },
                        PointRadius = new List<int>{0}, // hide points
                        PointHoverRadius = new List<int>{4},
                    }
                }
            };

        var options = new LineChartOptions();

        options.Interaction.Mode = InteractionMode.Index;

        options.Responsive = true;

        options.Scales.X.Title.Text = "Date";
        options.Scales.X.Title.Display = true;

        options.Plugins.Title.Text = "RMSE: " + rmse + " & " + "R squared: " + r_squared;
        options.Plugins.Title.Display = true;
        options.Plugins.Title.Font.Size = 20;

        options.Scales.Y.Title.Text = "Price";
        options.Scales.Y.Title.Display = true;

        await lineChart.InitializeAsync(data, options);
    }
}